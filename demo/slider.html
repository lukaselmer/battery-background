<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title></title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css"/>
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
    <script src="rgbcolor.js"></script>
    <script src="ColoredObject.js"></script>
    <script>
        $(function () {
            $("#slider").slider({
                orientation: "horizontal",
                max: 100,
                value: 100,
                slide: on_slider_changed,
                change: on_slider_changed
            });

            var body = $("body")
            var html = $("html")
            body.wrapInner("<div id='battery-background-inlay' />")

            var bbi = $("#battery-background-inlay");

            bbi.copyCSS(body);
            bbi.css({ width: '100%', 'height': '100%', margin: 0, position: "absolute", top: 0, left: 0, right: 0, bottom: 0 });
            body.css({width: '100%', height: '100%', padding: 0, background: "#000000"});
            html.css({width: '100%', height: '100%', padding: 0, background: "#000000"});

        });

        $.fn.copyCSS = function (source) {
            var dom = $(source).get(0);
            var dest = {};
            var style, prop;
            if (window.getComputedStyle) {
                var camelize = function (a, b) {
                    return b.toUpperCase();
                };
                if (style = window.getComputedStyle(dom, null)) {
                    var camel, val;
                    if (style.length) {
                        for (var i = 0, l = style.length; i < l; i++) {
                            prop = style[i];
                            camel = prop.replace(/\-([a-z])/, camelize);
                            val = style.getPropertyValue(prop);
                            dest[camel] = val;
                        }
                    } else {
                        for (prop in style) {
                            camel = prop.replace(/\-([a-z])/, camelize);
                            val = style.getPropertyValue(prop) || style[prop];
                            dest[camel] = val;
                        }
                    }
                    return this.css(dest);
                }
            }
            if (style = dom.currentStyle) {
                for (prop in style) {
                    dest[prop] = style[prop];
                }
                return this.css(dest);
            }
            if (style = dom.style) {
                for (prop in style) {
                    if (typeof style[prop] != 'function') {
                        dest[prop] = style[prop];
                    }
                }
            }
            return this.css(dest);
        };

        //
        //        function ColorLuminance(color, lum) {
        //
        //            console.log(color.toRGB() + ', ' + lum)
        //
        //            lum = lum || 1;
        //
        //            var avg = (color.r + color.g + color.b ) / 3;
        //            var do_complement = (lum < 0.5 && avg < 100);
        //
        //            var illuminate = function (colcomp_before) {
        //                //return Math.round(Math.min(Math.max(0, colcomp_before + (colcomp_before * lum)), 255));
        //                var correction = 0;
        //
        //                if (do_complement) {
        //                    correction = 255;
        //                }          else {
        //                }
        //
        //                return Math.round(Math.min(Math.max(0, correction + colcomp_before - (255 *  (1 - lum))), 255));
        //            }
        //
        //            var rgb = [illuminate(color.r, lum), illuminate(color.g, lum), illuminate(color.b, lum)];
        //
        //
        //            console.log(rgb);
        //            color = new RGBColor('');
        //
        //            color.r = rgb[0];
        //            color.g = rgb[1];
        //            color.b = rgb[2];
        //
        //            console.log(color.toRGB() + "\n\n");
        //            return color.toRGB();
        //        }
        //
        function on_slider_changed() {
            var val = $("#slider").slider("value") / 100;
            updateColors(val);
        }
        //
        function updateColors(factor) {

//            $(window.colored_objects).each(function () {
//                console.log(this);
//                this.object.css("background-color", ColorLuminance(this.original_background, factor));
//                this.object.css("color", ColorLuminance(this.original_foreground, factor));
//            });

            var bbi = $("#battery-background-inlay")
            bbi.fadeTo(10, factor);
        }

    </script>
</head>
<body style="background-color: #2b81af;">

<h1 style="">Test</h1>


<div id="slider"></div>

<button onclick="updateColors(0.1)">Lighter</button>
<button onclick="updateColors(-0.1)">Darker</button>


</body>
</html>